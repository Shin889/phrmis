{% extends 'template.html' %}
{% load static %}

{% block title %}
HRMIS | Family Background
{% endblock %}

{% block sidebar %}
{% endblock %}

{% block content %}
<div id="content" class="app-content">
    <form method="POST" class="fs-13px" name="signup" onsubmit="return checkpassword()" enctype="multipart/form-data">
        {% csrf_token %}
        <h1 class="page-header"><i class="fas fa-house-user me-2"></i>Family Background</h1>
        <div class="panel panel-inverse">
            <div class="panel-heading">
                <h4 class="panel-title"><i class="fas fa-heart me-2"></i>Spouse Information</h4>
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-warning" data-toggle="panel-collapse"><i
                            class="fa fa-minus"></i></a>
                </div>
            </div>
            <div class="panel-body">
                
                <div class="mb-3">
                    <label class="form-label">Spouse Surname</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="ssn" name="spousesurname" placeholder="Spouse Surname"
                            value="{{employee.spousesurname}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]+"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" required />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Spouse First Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="sfn" name="spousefirstname" placeholder="Spouse First Name"
                            value="{{employee.spousefirstname}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]+"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" required />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Spouse Middle Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="smn" name="spousemiddlename" placeholder="Spouse Middle Name (e.g., N/A if none)"
                            value="{{employee.spousemiddlename}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]*"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" />
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Occupation</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-briefcase"></i></span>
                        <input class="form-control" type="text" id="occ" name="occupation" placeholder="Occupation"
                            value="{{employee.occupation}}" />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Employer</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-building"></i></span>
                        <input class="form-control" type="text" id="emp" name="employer" placeholder="Employer"
                            value="{{employee.employer}}" />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Business Address</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-map-marked-alt"></i></span>
                        <input class="form-control" type="text" id="ba" name="businessaddress" placeholder="Business Address"
                            value="{{employee.businessaddress}}" />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Telephone</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-phone-square-alt"></i></span>
                        <input class="form-control" type="tel" id="tp" name="telephone"
                            placeholder="Telephone Number (e.g., 02-XXXX-XXXX)" value="{{employee.telephone}}" />
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-inverse">
    <div class="panel-heading">
        <h4 class="panel-title"><i class="fas fa-child me-2"></i>Children's Information</h4>
        <div class="panel-heading-btn">
            <a href="javascript:;" class="btn btn-xs btn-icon btn-warning" data-toggle="panel-collapse"><i
                    class="fa fa-minus"></i></a>
        </div>
    </div>
    <div class="panel-body">
        
        <div id="children_container">
            <div class="child-entry" data-child-index="1">
                <h5 class="mb-3 text-white">Children 1</h5>
                <div class="row">
                    <div class="col-md-8">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control" id="child_name_1" name="child_name_1" placeholder="Full Name of Child 1"
                                    value="{{employee.child_name_1}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]+"
                                    oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label class="form-label">Date of Birth</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                <input type="date" class="form-control" id="child_dob_1" name="child_dob_1"
                                    value="{{employee.child_dob_1|date:'Y-m-d'}}" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>

        <div class="text-end mt-4">
            <button type="button" class="btn btn-primary" id="addChildBtn">
                <i class="fas fa-plus me-2"></i>Add Another Child
            </button>
        </div>
    </div>
</div>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('children_container');
        const addButton = document.getElementById('addChildBtn');
        

        let childCount = container.querySelectorAll('.child-entry').length;

        function createChildEntry(index) {
        
            const newEntry = `
                <div class="child-entry border-top border-secondary pt-4 mt-4" data-child-index="${index}">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="text-white">Children ${index}</h5>
                        <button type="button" class="btn btn-danger btn-sm remove-child-btn" data-index="${index}">
                            <i class="fas fa-trash-alt"></i> Remove
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label class="form-label">Full Name</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                                    <input type="text" class="form-control" id="child_name_${index}" name="child_name_${index}" placeholder="Full Name of Children ${index}"
                                        style="text-transform: capitalize;" pattern="[a-zA-Z ]+" oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" required />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Date of Birth</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                    <input type="date" class="form-control" id="child_dob_${index}" name="child_dob_${index}" required />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            return newEntry;
        }

        addButton.addEventListener('click', function() {
            childCount++;
            const newChildHTML = createChildEntry(childCount);
            container.insertAdjacentHTML('beforeend', newChildHTML);
            
            attachRemoveListeners(); 
        });

        function attachRemoveListeners() {
            document.querySelectorAll('.remove-child-btn').forEach(button => {
                button.onclick = null; 
            });
            
         
            document.querySelectorAll('.remove-child-btn').forEach(button => {
                if (button.closest('.child-entry').getAttribute('data-child-index') > 1) {
                    button.onclick = function() {
                        const entryToRemove = this.closest('.child-entry');
                        entryToRemove.remove();
                        reindexChildren();
                    };
                }
            });
        }
        
        function reindexChildren() {
            let currentChildCount = 0;
            const entries = container.querySelectorAll('.child-entry');
            
            entries.forEach((entry, index) => {
                currentChildCount = index + 1;
                
                const header = entry.querySelector('h5');
                if (header) {
                
                    header.innerHTML = `Children ${currentChildCount}`;
                }
                
                const nameInput = entry.querySelector(`[name^="child_name_"]`);
                const dobInput = entry.querySelector(`[name^="child_dob_"]`);
                
                if (nameInput) {
                    nameInput.id = `child_name_${currentChildCount}`;
                    nameInput.name = `child_name_${currentChildCount}`;
                    nameInput.placeholder = `Full Name of Children ${currentChildCount}`;
                }
                
                if (dobInput) {
                    dobInput.id = `child_dob_${currentChildCount}`;
                    dobInput.name = `child_dob_${currentChildCount}`;
                }

                entry.setAttribute('data-child-index', currentChildCount);
                const removeButton = entry.querySelector('.remove-child-btn');
                if (removeButton) {
                    removeButton.setAttribute('data-index', currentChildCount);
                }
            });

            childCount = currentChildCount; 
        }

        attachRemoveListeners();
    });
</script>


        <div class="panel panel-inverse">
            <div class="panel-heading">
                <h4 class="panel-title"><i class="fas fa-male me-2"></i>Father's Information</h4>
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-warning" data-toggle="panel-collapse"><i
                            class="fa fa-minus"></i></a>
                </div>
            </div>
            <div class="panel-body">
                <div class="mb-3">
                    <label class="form-label">Father Surname</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="fsn" name="fathersurname" placeholder="Father Surname"
                            value="{{employee.fathersurname}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]+"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" required />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Father First Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="ffn" name="fatherfirstname" placeholder="Father First Name"
                            value="{{employee.fatherfirstname}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]+"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" required />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Father Middle Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="fmn" name="fathermiddlename" placeholder="Father Middle Name (e.g., N/A if none)"
                            value="{{employee.fathermiddlename}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]*"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Occupation</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-hard-hat"></i></span>
                        <input class="form-control" type="text" id="focc" name="fatheroccupation" placeholder="Father's Occupation"
                            value="{{employee.fatheroccupation}}" />
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-inverse">
            <div class="panel-heading">
                <h4 class="panel-title"><i class="fas fa-female me-2"></i>Mother's Information (Maiden Name)</h4>
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-warning" data-toggle="panel-collapse"><i
                            class="fa fa-minus"></i></a>
                </div>
            </div>
            <div class="panel-body">
                <div class="mb-3">
                    <label class="form-label">Mother Surname (Maiden)</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="msn" name="mothersurname" placeholder="Mother Surname (Maiden)"
                            value="{{employee.mothersurname}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]+"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" required />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Mother First Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="mfn" name="motherfirstname" placeholder="Mother First Name"
                            value="{{employee.motherfirstname}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]+"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" required />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Mother Middle Name</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                        <input class="form-control" type="text" id="mmn" name="mothermiddlename" placeholder="Mother Middle Name (e.g., N/A if none)"
                            value="{{employee.mothermiddlename}}" style="text-transform: capitalize;" pattern="[a-zA-Z ]*"
                            oninvalid="this.setCustomValidity('Must contain characters only.')" oninput="this.setCustomValidity('')" />
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Occupation</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-female"></i></span>
                        <input class="form-control" type="text" id="mocc" name="motheroccupation" placeholder="Mother's Occupation"
                            value="{{employee.motheroccupation}}" />
                    </div>
                </div>
            </div>
        </div>

        <div class="text-end mt-3">
            <button type="submit" class="btn btn-dark px-4"><i class="fas fa-save me-2"></i>Save</button>
        </div> 
    </form>
</div>
{% if error == "no" %}
<script>
    alert('Family Background Updated Successfully');
    window.location = ("familybackground");
</script>
{% endif %}
{% if error == "yes" %}
<script>
    alert('Something went wrong, try again.');
</script>
{% endif %}
{% endblock %}